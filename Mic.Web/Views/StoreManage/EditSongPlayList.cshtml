
@{
    ViewBag.Title = "EditSongPlayList";
    Layout = null;
}
@Styles.Render("~/Content/layui")

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/layui")
@Scripts.Render("~/bundles/minejs")

<div style="margin:10px;">
    <div class="layui-row">
        <button id="save_btn" class="layui-btn layui-btn-normal layui-btn-sm">保存</button>
        <button id="cancel_btn" class="layui-btn layui-btn-primary layui-btn-sm">取消</button>
    </div>
    <div id="table_content" style="height:300px;">
        
        <table class="layui-table" lay-filter="edit_song_list" id="edit_song_list"></table>
    </div>
    <div class="layui-row">
        <button id="import_song_list_btn" class="layui-btn layui-btn-normal layui-btn-sm">导入歌单</button>
        <button id="delete_song_btn" class="layui-btn layui-btn-primary layui-btn-sm">批量删除</button>
    </div>
</div>

<script>
    var table;
    layui.use('table', function () {
        table = layui.table;
        var form = layui.form;

        table.render({
            elem: '#edit_song_list'
            , height: "250"
            , page: false
            , url: '@Url.Action("GetPlayListByListContent", "StoreManage")'
            , limit: 10
            ,size:'sm'
            , where: { keyword: "", listContent: '@ViewBag.listContent' }
            ,limits: [10, 20, 30, 40, 50]
            ,autoSort: false
            , cols: [[
                { type: 'checkbox' }
                ,{type: "numbers", width:50}
                , { field: 'SongName', minWidth: 100, title: '歌曲名称' }
                , { field: 'SongLength', width: 130, title: '时长'}
                , { field: 'SingerName', width: 150, title: '歌手' }
                , { field: 'ExpirationTimeStr', title: '版权有效期至', width: 200 }
            ]]
            , parseData: function (res) {

                $.each(res.data, function (index, value) {
                    value.ExpirationTime = Service.FormatDate("yyyy-MM-dd", Service.ConvertNetDate(value.ExpirationTime));

                    var currentTime = new Date();
                    if (value.ExpirationTime) {
                        var arr1 = value.ExpirationTime.split(" ");
                        var sdate = arr1[0].split('-');
                        var date = new Date(sdate[0], sdate[1] - 1, sdate[2]);
                        if (date < currentTime) {
                            value.ExpirationTimeStr = "已过期";
                        } else {
                            value.ExpirationTimeStr = value.ExpirationTime;
                        }
                    }

                });
                return {
                    "code": res.code, "msg": res.msg, "count": res.count, "data": res.data 
                };
            }
            , done: function (res,curr,count) {
                //$("#songListUpdateTime").html(Service.FormatDate("yyyy-MM-dd HH:mm:ss", Service.ConvertNetDate(listItem.UpdateTime)));
            }
        });

    });

    $("#cancel_btn").click(function () {
        parent.layer.closeAll();
    });
    $("#save_btn").click(function () {
        layer.closeAll('iframe');
    });
    $("#import_song_list_btn").click(function () {
        layer.closeAll('iframe');
    });
    $("#delete_song_btn").click(function () {
        var checkStatus = table.checkStatus('edit_song_list');
        if (checkStatus.data.length < 1) {
            layer.alert("请选择一条数据操作");
            return false;
        } else {
            cbList = table.cache.edit_song_list;
            for (var k = 0; k < checkStatus.data.length; k++) {
                var _delId = checkStatus.data[k].Id;
                for (var i = 0; i < cbList.length; i++) {
                    var _id = cbList[i].Id;
                    if (_id == _delId) {
                        cbList.splice(i, 1);
                        break;
                    }
                }
            }
            table.reload('edit_song_list', { data: cbList});
        }
        //parent.layer.closeAll();
    });
</script>

