
@{
    ViewBag.Title = "曲库列表";
}
<style>
    .r_content {
        padding-top: 25px;
        padding-left: 20px;
    }

    .search_div {
        padding-left: 10px;
        margin-top: 10px;
        line-height: 50px;
        height: 50px;
        background-color: rgb(244,244,244);
    }

    #song_search_text, #audit_search_text, #audit_status_select {
        margin-right: 30px;
        height: 32px;
        width: 250px;
    }

    content, .left_menu {
        height: 500px;
    }

    .my_nav .layui-nav-item a {
        color: rgb(128, 128, 128);
    }

    .layui-nav-tree .layui-this a, .layui-nav-tree .layui-this > a:hover {
        background-color: #eee;
        color: #1E90FF;
    }
</style>
<div class="layui-row content">
    <div class="layui-col-sm2 layui-col-lg2 layui-col-md2 left_menu">
        <ul class="my_nav layui-nav layui-nav-tree " style="margin-top:20px; background-color:white;">
            <li class="my_nav_li layui-nav-item layui-this">
                <a href="javascript:;" data-name="list">曲库列表</a>
            </li>
            <li class="my_nav_li layui-nav-item">
                <a href="javascript:;" data-name="audit">曲库审核</a>
            </li>
        </ul>
    </div>
    <!--列表-->
    <div id="song_list" class="layui-col-sm10 layui-col-lg10 layui-col-md10 r_content">
        <div style="margin-left:10px;">
            <button type="button" class="layui-btn layui-btn-normal layui-btn-sm">上传歌曲</button>
            <button type="button" class="layui-btn layui-btn-primary layui-btn-sm">设置标签</button>

        </div>
        <div class="search_div">
            搜索歌曲
            <div class="layui-input-inline">
                <input type="text" id="song_search_text" autocomplete="off" placeholder="请输入歌曲名称或歌手名称" class="layui-input">
            </div>
            <button id="song_search_btn" type="button" class="layui-btn layui-btn-normal layui-btn-sm">搜索</button>
            <button id="song_search_reset_btn" type="button" class="layui-btn layui-btn-primary layui-btn-sm">重置</button>

        </div>
        <div id="table_content">
            <table class="layui-hide" lay-filter="songbook" id="songbook"></table>
        </div>
    </div>
    <!--审核-->
    <div id="song_audit" style="display:none;" class="layui-col-sm10 layui-col-lg10 layui-col-md10 r_content">

        <div class="search_div">
            搜索歌曲
            <div class="layui-input-inline">
                <input type="text" id="audit_search_text" autocomplete="off" placeholder="请输入歌曲名称或歌手名称" class="layui-input">
            </div>

            审核状态
            <div class="layui-input-inline">
                <select id="audit_status_select">
                    <option value="-1" selected="">全部</option>
                    <option value="1">待审核</option>
                    <option value="2">已通过</option>
                    <option value="3">未通过</option>
                </select>
            </div>


            <button id="audit_search_btn" type="button" class="layui-btn layui-btn-normal layui-btn-sm">搜索</button>
            <button id="song_audit_search_reset_btn" type="button" class="layui-btn layui-btn-primary layui-btn-sm">重置</button>

        </div>
        <div id="table_content">
            <table class="layui-hide" lay-filter="audit_list" id="audit_list"></table>
        </div>
    </div>
</div>
<script>
    var songListTable;
    var auditListTable;
    layui.use('table', function () {
        var table = layui.table;
        // 曲库列表
        songListTable = table.render({
            elem: '#songbook'
            , height: "full-235"
            ,page: true
            , url: '@Url.Action("GetApprovedSongList", "SongManage")'
            ,limit: 10
            //,size: 'sm'
            ,limits: [10, 20, 30, 40, 50]

            , cols: [[
                {type: "numbers", fixed:"left", width:50},
                , {
                    field: '', width: 50, title: '',
                    templet: function (d) {
                        return "<i class='layui-icon' >&#xe652;</i>";
                    }
                }
                , { field: 'SongName', minWidth: 100, title: '歌曲名' }
                , { field: 'SongLength', width: 120, title: '时长'}
                , { field: 'SingerName', width: 120, title: '歌手' }
                , { field: 'ExpirationTime', title: '版权有效期至', width: 200 }
                , { field: 'PlayTimes', width: 120, title: '播放次数', sort: true }
                , { fixed: 'right', title: '操作', toolbar: '#barDemo', width: 140 }
            ]]
            , parseData: function (res) { //res 即为原始返回的数据
                $.each(res.data, function (index, value) {
                    value.ExpirationTime = Service.FormatDate("yyyy-MM-dd HH:mm:ss", Service.ConvertNetDate(value.ExpirationTime));
                    value.SongLength = Service.ConvertSecondsTime(value.SongLength);
                });
                return {
                    "code": res.code, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.count, //解析数据长度
                    "data": res.data //解析数据列表
                };
            }

        });


        //监听行工具事件
        table.on('tool(songbook)', function (obj) { //注：tool 是工具条事件名，songbook 是 table 原始容器的属性 lay-filter="对应的值"
            var data = obj.data //获得当前行数据
                , layEvent = obj.event; //获得 lay-event 对应的值
             if (layEvent === 'del') {
                layer.confirm('真的删除行么', function (index) {
                    obj.del(); //删除对应行（tr）的DOM结构
                    layer.close(index);
                    //向服务端发送删除指令
                });
            } else if (layEvent === 'edit') {
                 layer.msg('编辑操作');
                 layer.open({
                     type: 1,
                     title: '<span style="font-weight:bolder;">上传歌曲</span>',
                     move: false,
                     btn: ['确定', '取消'],
                     skin: 'tempSkin',
                     area: [window.dlgSizeInfo.dlgWidth, window.dlgSizeInfo.dlgHeight],
                     content: $('#menu_edit_div'),
                     success: function () {
                         $('#menu_name').val(name);
                         $("#menuLevel").val(menuLevel);
                         //$('#menu_status').selectpicker('val', status);



                         $('#song_edit_div').attr("display", 'block');

                         //$(".tempSkin .layui-layer-content").css("height", $(".tempSkin").height() - 36 * 2);
                         //$(".tempSkin .layui-layer-btn a").removeClass().addClass('bottom_btn');
                     },
                     end: function () {
                         $('#song_edit_div').attr("display", 'none');
                     },
                     yes: function (index, layero) {
                         menuObj.SaveBtn();
                     }
                 });

            }
        });


        // 审核列表
        auditListTable = table.render({
            elem: '#audit_list'
            , height: "full-200"
            ,page: true
            , url: '@Url.Action("GetAuditSongList", "SongManage")'
            , limit: 10
            //, size: 'sm'
            ,limits: [10, 20, 30, 40, 50]
            , cols: [[
                {type: "numbers", fixed:"left", width:50},
                , {
                    field: '', width: 50, title: '',
                    templet: function (d) {
                        return "<i class='layui-icon' >&#xe652;</i>";
                    }
                }
                , { field: 'SongName', width: 200, title: '歌曲名' }
                , { field: 'SongLength', width: 80, title: '时长'}
                , { field: 'SingerName', width: 140, title: '独立音乐人' }
                , { field: 'AuditStatusStr', title: '审核状态', width: 100 }
                , { field: 'HasCopyright', width: 100, title: '版权证明' }
                , { fixed: 'right', title: '操作', toolbar: '#barAudit', width: 140 }
            ]]
            , parseData: function (res) { //res 即为原始返回的数据
                $.each(res.data, function (index, value) {
                    value.ExpirationTime = Service.FormatDate("yyyy-MM-dd HH:mm:ss", Service.ConvertNetDate(value.ExpirationTime));
                    value.SongLength = Service.ConvertSecondsTime(value.SongLength);
                    value.HasCopyright = Service.IsNullOrEmpty(value.CopyrightFilePath) ? "无" : "有";
                    switch (value.AuditStatus) {
                        case 1:
                            value.AuditStatusStr = "待审核";
                            break;
                        case 2:
                            value.AuditStatusStr = "已通过";
                            break;
                        case 3:
                            value.AuditStatusStr = "未通过";
                            break;
                    }
                });
                return {
                    "code": res.code, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.count, //解析数据长度
                    "data": res.data //解析数据列表
                };
            }

        });

        // 左侧菜单切换
        $(".my_nav_li").delegate("a", "click", function (e) {
            var data = $(this).attr("data-name");
            if (data == "list") {
                $("#song_audit").hide();
                $("#song_list").show();
            } else if (data == "audit") {
                $("#song_audit").show();
                $("#song_list").hide();
            }
        });
        $("#song_search_btn").click(function () {
            songListTable.reload({

                     where: { keyword: $("#song_search_text").val() }//这里传参  向后台
                    , url: '@Url.Action("GetApprovedSongList", "SongManage")'
                    , method: 'get'
                });
        });
        $("#audit_search_btn").click(function () {
            auditListTable.reload({
                     where: { keyword: $("#audit_search_text").val() }//这里传参  向后台
                    , url: '@Url.Action("GetAuditSongList", "SongManage")'
                    , method: 'get'
                });
        });

        $("#song_search_reset_btn").click(function () {
            $("#song_search_text").val("");
            $("#song_search_btn").click();
        });
         $("#song_audit_search_reset_btn").click(function () {
             $("#audit_search_text").val("");
             $("#audit_status_select").val(-1);
             $("#audit_search_btn").click();
        });
    });
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script type="text/html" id="barAudit">
    {{#  if(d.AuditStatus == '1'){ }}
    <a class="layui-btn layui-btn-xs " lay-event="">审核</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-primary layui-btn-xs layui-btn-disabled " lay-event="">审核</a>
    {{# } }}
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="">查看详情</a>
</script>

<div id="song_edit_div" style="display:none">

</div>